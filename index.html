<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Glitch Area</title>

<!-- FAVICON -->
<link rel="icon" type="image/png" href="icon.png">

<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }

#menu, #gameOver {
position:absolute;
top:0; left:0;
width:100%; height:100%;
background:black;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
color:white;
z-index:10;
}

button{
padding:15px 30px;
font-size:20px;
cursor:pointer;
}

#hud{
position:absolute;
top:10px;
left:10px;
color:white;
z-index:5;
}

#crosshair{
position:absolute;
top:50%; left:50%;
transform:translate(-50%,-50%);
width:40px;
height:40px;
background:url("viseur.png") no-repeat center;
background-size:contain;
pointer-events:none;
display:none;
z-index:5;
}
</style>
</head>
<body>

<div id="menu">
<h1>GLITCH AREA</h1>
<button onclick="startGame()">Start Game</button>
</div>

<div id="gameOver" style="display:none;">
<h1>GAME OVER</h1>
<button onclick="location.reload()">Restart</button>
</div>

<div id="hud">HP: <span id="hp">100</span></div>
<div id="crosshair"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>

let scene, camera, renderer, player;
let enemies = [], enemyBullets = [], bullets = [];
let keys = {};
let hp = 100;
let gameStarted = false;

function startGame(){
document.getElementById("menu").style.display="none";
document.getElementById("crosshair").style.display="block";
init();
gameStarted = true;
document.body.requestPointerLock();
}

function init(){
scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

camera = new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));

// FLOOR
let floor = new THREE.Mesh(
new THREE.PlaneGeometry(200,200),
new THREE.MeshStandardMaterial({color:0x111111})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// PLAYER
player = new THREE.Object3D();
player.position.set(0,1.6,0);
scene.add(player);
player.add(camera);

// WALLS (Labyrinth style)
let wallMat = new THREE.MeshStandardMaterial({color:0x222222});
for(let x=-40;x<=40;x+=10){
for(let z=-40;z<=40;z+=10){
if(Math.random()>0.6){
let wall = new THREE.Mesh(new THREE.BoxGeometry(8,4,1),wallMat);
wall.position.set(x,2,z);
scene.add(wall);
}
}
}

// ENEMIES
for(let i=0;i<5;i++){
createEnemy((Math.random()-0.5)*60,(Math.random()-0.5)*60);
}

animate();
}

function createEnemy(x,z){
let enemy = new THREE.Group();

let body = new THREE.Mesh(
new THREE.BoxGeometry(1.5,2,1.5),
new THREE.MeshStandardMaterial({color:0x000000})
);
body.position.y=1;
enemy.add(body);

enemy.position.set(x,0,z);
enemy.userData.cool=0;

scene.add(enemy);
enemies.push(enemy);
}

// CONTROLS
document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

let yaw=0,pitch=0;
document.addEventListener("mousemove",(e)=>{
if(document.pointerLockElement===document.body && gameStarted){
yaw -= e.movementX*0.002;
pitch -= e.movementY*0.002;
pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch));
player.rotation.y=yaw;
camera.rotation.x=pitch;
}
});

// SHOOT (Raycast direction exact centre)
document.addEventListener("mousedown",()=>{
if(!gameStarted) return;

let bullet = new THREE.Mesh(
new THREE.SphereGeometry(0.1),
new THREE.MeshBasicMaterial({color:0xffff00})
);

bullet.position.copy(camera.getWorldPosition(new THREE.Vector3()));

// direction EXACT centre screen
let dir = new THREE.Vector3();
camera.getWorldDirection(dir);
bullet.userData.vel = dir.multiplyScalar(1.2);

scene.add(bullet);
bullets.push(bullet);
});

// LOOP
function animate(){
requestAnimationFrame(animate);
if(!gameStarted) return;

// MOVE
let forward=new THREE.Vector3();
camera.getWorldDirection(forward);
forward.y=0;
forward.normalize();

let right=new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0));

if(keys["w"]) player.position.add(forward.clone().multiplyScalar(0.3));
if(keys["s"]) player.position.add(forward.clone().multiplyScalar(-0.3));
if(keys["a"]) player.position.add(right.clone().multiplyScalar(0.3));
if(keys["d"]) player.position.add(right.clone().multiplyScalar(-0.3));

player.position.y=1.6;

// PLAYER BULLETS
bullets.forEach((b,i)=>{
b.position.add(b.userData.vel);

enemies.forEach((e,ei)=>{
if(b.position.distanceTo(e.position)<1){
scene.remove(e);
enemies.splice(ei,1);
}
});
});

// ENEMIES SHOOT
enemies.forEach(e=>{
e.lookAt(player.position);
e.userData.cool--;
if(e.userData.cool<=0){
let bullet=new THREE.Mesh(
new THREE.SphereGeometry(0.15),
new THREE.MeshBasicMaterial({color:0xff0000})
);
bullet.position.copy(e.position);
bullet.position.y=1;
let dir=player.position.clone().sub(e.position).normalize();
bullet.userData.vel=dir.multiplyScalar(0.5);
scene.add(bullet);
enemyBullets.push(bullet);
e.userData.cool=100;
}
});

// ENEMY BULLETS
enemyBullets.forEach(b=>{
b.position.add(b.userData.vel);
if(b.position.distanceTo(player.position)<1){
hp -= 10;
document.getElementById("hp").textContent=hp;
scene.remove(b);
if(hp<=0){
document.getElementById("gameOver").style.display="flex";
gameStarted=false;
}
}
});

renderer.render(scene,camera);
}
</script>
</body>
</html>

