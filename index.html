<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Glitch Area - Infiltration</title>
<link rel="icon" href="icon.png">
<style>
body{margin:0;overflow:hidden;background:black;color:white;font-family:Arial;}
#menu,#gameOver,#win{
position:absolute;top:0;left:0;width:100%;height:100%;
display:flex;flex-direction:column;justify-content:center;align-items:center;
background:black;z-index:10;
}
button{padding:15px 30px;font-size:18px;cursor:pointer;}
#hud{position:absolute;top:10px;left:10px;z-index:5;}
#crosshair{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
width:40px;height:40px;
background:url("viseur.png") no-repeat center;
background-size:contain;
pointer-events:none;display:none;
}

/* ðŸŽ­ MASK EFFECT */
#maskOverlay{
position:absolute;
top:0;left:0;
width:100%;height:100%;
background:radial-gradient(circle at center, transparent 55%, black 100%);
display:none;
pointer-events:none;
z-index:6;
}
</style>
</head>
<body>

<div id="menu">
<h1>GLITCH AREA</h1>
<button onclick="startGame()">Start Mission</button>
</div>

<div id="gameOver" style="display:none;">
<h1>MISSION FAILED</h1>
<button onclick="location.reload()">Retry</button>
</div>

<div id="win" style="display:none;">
<h1>MISSION COMPLETE</h1>
<button onclick="location.reload()">Replay</button>
</div>

<div id="hud">HP: <span id="hp">100</span></div>
<div id="crosshair"></div>
<div id="maskOverlay"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>

let scene, camera, renderer;
let player, cameraPivot;
let enemies=[], bullets=[], enemyBullets=[];
let keys={}, hp=100, gameStarted=false;
let wave=1;

function startGame(){
document.getElementById("menu").style.display="none";
document.getElementById("crosshair").style.display="block";

init();
gameStarted=true;

document.body.requestPointerLock();
animate();
}

function init(){

scene=new THREE.Scene();
scene.background=new THREE.Color(0x000000);
scene.fog=new THREE.Fog(0x000000,20,100);

camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);

renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

// LIGHT
let light=new THREE.HemisphereLight(0xffffff,0x222222,1.2);
scene.add(light);

// FLOOR
let floor=new THREE.Mesh(
new THREE.PlaneGeometry(200,200),
new THREE.MeshStandardMaterial({color:0x111111})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

// PLAYER
player=new THREE.Mesh(
new THREE.BoxGeometry(1,2,1),
new THREE.MeshStandardMaterial({color:0x222222})
);
player.position.set(0,1,0);
scene.add(player);

// CAMERA SYSTEM
cameraPivot=new THREE.Object3D();
cameraPivot.position.y=1.5;
player.add(cameraPivot);
cameraPivot.add(camera);
camera.position.set(0,0,0);

// GUN
let gun=new THREE.Mesh(
new THREE.BoxGeometry(0.4,0.3,1.5),
new THREE.MeshStandardMaterial({color:0x555555,metalness:1,roughness:0.4})
);
gun.position.set(0.5,-0.3,-1);
camera.add(gun);

spawnWave();
}

// CONTROLS
document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

let yaw=0,pitch=0;
document.addEventListener("mousemove",(e)=>{
if(document.pointerLockElement===document.body && gameStarted){
yaw-=e.movementX*0.002;
pitch-=e.movementY*0.002;
pitch=Math.max(-1.2,Math.min(1.2,pitch));
player.rotation.y=yaw;
cameraPivot.rotation.x=pitch;
}
});

// SHOOT
document.addEventListener("mousedown",()=>{
if(!gameStarted) return;

let b=new THREE.Mesh(
new THREE.SphereGeometry(0.15),
new THREE.MeshBasicMaterial({color:0xffffff})
);

b.position.copy(camera.getWorldPosition(new THREE.Vector3()));

let dir=new THREE.Vector3();
camera.getWorldDirection(dir);
b.userData.vel=dir.multiplyScalar(1);

scene.add(b);
bullets.push(b);
});

// SPAWN WAVE
function spawnWave(){
for(let i=0;i<wave*3;i++){
let e=new THREE.Mesh(
new THREE.BoxGeometry(1.5,2,1.5),
new THREE.MeshStandardMaterial({color:0x000000})
);
e.position.set(
(Math.random()-0.5)*60,
1,
(Math.random()-0.5)*60
);
e.userData.cool=0;
scene.add(e);
enemies.push(e);
}
}

// LOOP
function animate(){
requestAnimationFrame(animate);
if(!gameStarted) return;

// MOVEMENT
let forward=new THREE.Vector3();
camera.getWorldDirection(forward);
forward.y=0;
forward.normalize();

let right=new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0));

let speed=0.15;

if(keys["w"]) player.position.add(forward.clone().multiplyScalar(speed));
if(keys["s"]) player.position.add(forward.clone().multiplyScalar(-speed));
if(keys["a"]) player.position.add(right.clone().multiplyScalar(-speed));
if(keys["d"]) player.position.add(right.clone().multiplyScalar(speed));

// PLAYER BULLETS
bullets.forEach((b)=>{
b.position.add(b.userData.vel);

enemies.forEach((e,i)=>{
if(b.position.distanceTo(e.position)<1){
scene.remove(e);
enemies.splice(i,1);
}
});
});

// ENEMY AI
enemies.forEach(e=>{
e.lookAt(player.position);

let dir=player.position.clone().sub(e.position).normalize();
e.position.add(dir.multiplyScalar(0.03));

e.userData.cool--;
if(e.userData.cool<=0){
let b=new THREE.Mesh(
new THREE.SphereGeometry(0.2),
new THREE.MeshBasicMaterial({color:0xffffff})
);
b.position.copy(e.position);
b.userData.vel=player.position.clone().sub(e.position).normalize().multiplyScalar(0.4);
scene.add(b);
enemyBullets.push(b);
e.userData.cool=120;
}
});

// ENEMY BULLETS
enemyBullets.forEach(b=>{
b.position.add(b.userData.vel);
if(b.position.distanceTo(player.position)<1){
hp-=5;
document.getElementById("hp").textContent=hp;
scene.remove(b);
if(hp<=0){
document.getElementById("gameOver").style.display="flex";
gameStarted=false;
}
}
});

// NEXT WAVE
if(enemies.length===0){
wave++;
if(wave>5){
document.getElementById("win").style.display="flex";
gameStarted=false;
}else{
spawnWave();
}
}

renderer.render(scene,camera);
}

</script>
</body>
</html>
